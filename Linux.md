Linux

# 1.常见概念和功能

## 1.1网络连接的三种方式

1. 桥接模式：虚拟机可以与外部系统通讯，但是容易造成IP冲突
2. NAT模式：网络地址转换模式，虚拟机可以与外部系统通讯，不造成ip冲突
3. 主机模式：独立的系统



## 1.2虚拟机的克隆

- 方式一：直接拷贝一份虚拟机文件
- 使用VMware工具进行克隆

## 1.3虚拟机快照

## 1.4虚拟机的迁移和删除

# 2.Linux文件与目录结构

## 文件

Linux中一切皆文件

## 目录结构

根目录：/

# 3.VI和VIM编辑器

## 一般模式

**进入： vim 目录名**

常用语法：

| 语法       | 功能描述                   |
| ---------- | -------------------------- |
| yy         | 复制光标当前的一行         |
| y数字y     | 从当前光标连续复制n行      |
| p          | 移动到目的行进行粘贴       |
| u          | 撤销上一步                 |
| dd         | 删除光标当前行             |
| d数字d     | 连续删除光标后的n行        |
| x          | 剪切位于当前光标的一个字符 |
| X          | 剪切当前光标的前一个字符   |
| yw         | 复制一个词                 |
| dw         | 删除一个词                 |
| shift + ^  | 移动到行头                 |
| shift + $  | 移动到行尾                 |
| w          | 移动到下一个词的词头       |
| e          | 移动到当前词的词尾         |
| 1 + G      | 移动到页头                 |
| G          | 移动到页尾                 |
| 数字 N + G | 移动到目标行               |



## 编辑模式

**进入 ： i**

常用语法：

| 按键 | 功能                       |
| ---- | -------------------------- |
| i    | 到当前光标前进行插入       |
| a    | 到当前光标后进行插入       |
| o    | 到当前光标的下一行进行插入 |
| I    | 到当前光标所在行的最前     |
| A    | 到当前光标所在行的最后     |
| O    | 到当前光标行的上一行       |

**退出： esc**

## 指令模式

| 命令           | 功能                                     |
| -------------- | ---------------------------------------- |
| ：w            | 保存                                     |
| ：q            | 退出                                     |
| ：wq           | 保存并退出                               |
| ：q！          | 不保存强制退出                           |
| /要查找的词    | n跳转到下一个目标词，N跳转到上一个目标词 |
| ：set nu       | 显示行号                                 |
| ：set nonu     | 不显示行号                               |
| ：nuh          | 取消高亮显示                             |
| ：s/old/new    | 替换当前行匹配到的第一个old为new         |
| ：s/old/new/g  | 替换当前行匹配到的所有old为new           |
| ：%s/old/new   | 替换文档中每行匹配到的第一个old为new     |
| ：%s/old/new/g | 替换文档中匹配到的所有old为new           |





# 4.开机，重启和用户登录注销



## 关机重启命令

| shut -h now     | 立刻进行关机           |
| --------------- | ---------------------- |
| shut -h 1       | 一分钟后关机           |
| shutdown -r now | 现在重启计算机         |
| halt            | 关机作用和上面一样     |
| reboot          | 现在重新启动计算机     |
| sync            | 把内存的数据同步到磁盘 |

**注意：**无论是重启还是关机，即使指令已经默认指向sync，但是还是要手动执行

## 用户登录和注销

注销：logout

登录使用普通账户登录需要使用**su -root**指令切换为管理员身份

在图形运行级别下无效，在运行级别3下有效

# 5实用指令

## 指定运行级别:

运行级别说明：

1. 0：关机
2. 1：单用户【找回丢失密码】
3. 2:多用户状态没有网络了
4. 3:多用状态有网络服务
5. 4:系统未使用留给自己
6. 5：图形界面
7. 6：重启系统

**注意：**可以通过init来切换不同的运行级别

## 帮助指令

- man获得帮助信息，基本语法：man[命令或者配置文件]
- help指令
  - 基本语法：help + 命令（功能描述：获得shell内置命令的帮助信息）



## 文件目录指令

- pwd指令
  - 基本语法pwd		功能描述：显示当前工作目录的绝对路径
- ls指令
  - 基本语法：ls[选项][目录或是文件]
  - 常用选项：-a：显示当前目录所有的文件和目录，包括隐藏的；-i：以列表的形式显示信息
- cd指令
  - 基本语法：cd[参数]		功能描述：切换到指定目录
  - cd~：回到自己的家目录
  - cd..：会到当前目录的上一级目录
- mkdir指令
  - 基本语法：mkdir [选项] 要创建的目录
  - -p：创建多级目录
- rmdir指令：删除空目录
  - 基本语法：rmdir [选项] 要删除的空目录
  - 如果需要删除非空目录，需要使用：rm -rf  要删除的目录
- touch指令：创建空文件夹
  - 基本语法：touch  文件名称 
- cp指令：拷贝文件到指定目录
  - 基本语法：cp  [选项] source  dest
  - 常用选项：-r：递归复制整个文件夹 
- rm指令：移除文件或目录
  - 基本语法：rm [选项] 要删除的文件或者目录
  - 常用选项：-r：递归删除整个文件夹；-f:强制删除不提示
- mv指令：移动文件或重命名
  - mv  oldNameFile  newNameFile ：重命名
  - mv /temp/movefile  /tergetFolder：移动文件
- cat指令：查看文件
  - 基本语法：cat  [选项]  要查看的文件
  - 常用选项：-n:显示行号
- less指令：用来分屏查看文件内容，功能与more类似
  - 基本语法:less 要查看的文件
- echo指令：输出内容到控制台
  - 基本语法：echo  [选项]   [输出内容]
- head指令:用于显示文件的开头部分，默认显示i文件的前十行
  - 基本语法：head  文件  （查看文件的前十行）
  - head  -n  5  文件：查看文件 尾五行，但是这五行容易改
- tail指令：用于输出文件尾部的内容，默认显示最后十行
  - 基本语法：tail  文件  （功能描述：查看文件尾十行内容）
  - tail  -n  5：查看看文件尾五行内容，5可以是任何数
  - tail  -f  文件：实时追踪文件所有的更新
- ln指令：符号链接，存放其他文件路径
  - 基本语法：ln  -s [元文件或目录]  [软链接名]
  - 例如：在/home目录下创建一个软链接/myroot,连接到/root目录：ln  -s  /root  /home/myroot
- history指令：查看执行过的指令
  - 查看最近十条： history 10
  - 执行编号为五的指令：！5

## 时间日期类

* date指令：显示当前日期
  * 基本语法
  * date：显示当前时间
  * date + %Y：显示当前年份
  * date + %m：显示当前月份
  * date + %d：显示当前是那一天
  * date + ”%Y - %m - %d   %H:%M:%S“：显示当前年月日时分秒
* date指令设置系统当前时间
  * 基本语法：date  -s  字符串时间
  * 例如：设置时间为2020-11-03  20：02 ：10；date  -s  ”2020-11-03  20：02：10“

## 搜索查找类

* cal指令：查看日历指令

  * 基本语法：cal[选项]（不加选项显示本月日历）

* find指令：在指定目录下进行递归搜索，将满足条件的文件显示在终端

  * 基本语法：find  [搜索范围]  [选项]

  * 选项说明：

    | 选项  | 功能                                        |
    | ----- | ------------------------------------------- |
    | -name | 按文件名查询                                |
    | -user | 查找指定用户名所有文件                      |
    | -size | 按照指定大小查找文件(+n大于，-n小于，n等于) |

* locate指令：快速定位文件路径

  * 基本语法：locate 搜索文件
  * 在使用该指令之前需要先使用updatedb指令创建一个数据库

* which指令：查看指令位于哪个目录下

* grep指令和管道符号 |

  * grep过滤查找；管道符号|表示将前一个命令的处理结果输出传递给后一个指令处理

  * 基本语法：grep[选项] 查找内容  原文件

  * 常用选项

    | 选项 | 功能             |
    | ---- | ---------------- |
    | -n   | 显示匹配行及行号 |
    | -i   | 忽略字母大小写   |



## 压缩和解压

- gzip/gunzip指令：前者用于压缩文件后者用于解压
  - 基本语法：gzip  文件(压缩文件只能将文件压缩为,gz文件)
  - gunzip  文件.gz（解压缩文件）

- zip/unzip指令：用于压缩和解压文件夹

  - zip常用选项：-r：递归压缩，及压缩目录
  - unzip常用选项：-d<目录>：解压到指定目录

- tar指令：打包指令，最后打包后的文件时.tar.gz文件

  - 基本语法：tar [选项]  XXX.tar.gz  打包的内容

  - 常用选项

    | 选项 |        功能        |
    | :--: | :----------------: |
    |  -c  |  产生.tar打包文件  |
    |  -v  |    显示详细信息    |
    |  -f  | 指定压缩后的文件名 |
    |  -z  |   打包同时压缩·    |
    |  -x  |   捷报.tar文件`    |



# 6.组管理和权限管理

## 组管理

### 所有者

- 一般为谁是文件的创建者，谁就是该文件的所有者
- 查看文件的所有者
  - 指令：ls  -shl
- 修改文件所有者
  - 指令：chown  用户名  文件名

### 所在组

- 创建组指令：groupadd  组名

- 应用实例
  - 创建一个组：groupadd monster
  - 创建一个用户，并放到monster中：useradd -g monster fox
- 查看文件目录所在组：ls -ahl
- 修改文件目录所在组：chgrp  组名  文件名



### 其他组

除了文件的所有者和所在组的用户外，系统的其他用户都是文件的其他组

- 改变用户所在组
  - usermod  -g  新组名  用户名
  - usermod  -d  目录名  用户名  改变该用户登录的初始目录



## 修改所有者和所在组

### 修改所有者

- chown  newowner  文件/目录                                改变所有者
- chown  newowner：newgroup                              文件/目录  改变所有者和所在组
- -r：如果是目录则使子文件或目录全部递归生效

### 修改所在组

- chgrp  newgroup  文件/目录                          改变所在组

## 权限管理

### 权限说明

使用ls -l指令后会显示以下内容：

-rwxrw-r--  1  root  root  1213  February 2  09：39  abc

- 0~9位说明
  - 第零位确定文件类型
  - i：链接
  - d：目录
  - c：字符设备文件
  - b：块设备，如硬盘
- 1~3位是所有者用户权限
  - r:代表可读
  - w：代表可写
  - x：代表可执行
- 4~6是所在组其他用户的权限
- 7~10是其他组用户的权限
- 第一个root是所属用户名
- 第二个root是所属用户所在组
- 1213代表文件字节数
- 后面是日期和时间
- 最后是用户名







### 修改权限

- chmod指令：修改文件或者目录的权限
- 第一种方式：+，-，=变更权限
  - u：所有者；g:所在组；o:其他人；a：所有人
  - 例子：给abx文件的所有者读写执行的权限，给所在组读写权限，给其他组读执行权限——>chomd  u= rwx，g = rx，o= rx abc
- 第二种：使用数字变更权限
  - r= 4；w= 2；x= 1；
  - chmod  u = rwx，g = rx，o=x 文件目录名   相当于   chmod  751  文件目录名









# 7.定时任务调度

## crond定时任务

概述：是指形同在某个时间执行的特定的命令或程序

**分类：**

1. 系统工作：有些重要的工作必须周而复始的工作
2. 个别用户工作：个别用户可能希望执行某些程序，如数据库的备份

**基本语法：**crontab[选项]

**常用选项：**

|  -e  |      编辑crontab定时任务      |
| :--: | :---------------------------: |
|  -l  |        查询crontab任务        |
|  -r  | 删除当前用户所有的crontab任务 |

  

- 特殊符号说明

  | 特殊符号 | 含义                                                         |
  | -------- | ------------------------------------------------------------ |
  | *        | 代表任何时间。比如第一个”*“就代表一小时中每分钟都执行一次    |
  | ，       | 代表不连续的时间。比如”0   8，12，16*  *  *“，就代表在每天的8点0分，12点0分，16点0分都执行一次命令 |
  | -        | 代表连续的时间范围。比如”0  5  *  *  *  1-6“，代表周一到周六的凌晨一点到五点执行命令 |
  | */n      | 代表每隔多久执行一次。比如”*/10  *  *  *  *  “，代表每隔十分钟执行一次命令 |

   

- crontab相关指令

  - crontab  -l：列出当前有哪些任务调度
  - crontab  -r:终止任务调度
  - service crond  restare ：重启任务调度

## at定时任务

- 基本介绍：
  - at命令是一次性定时计划任务，at的守护进程atd会以后台模式运行，检查作业列队来运行
  - 默认情况下，atd守护进程每六十秒检查作业列队，有作业是会检查作业的运行时间，如果时间与当前事件匹配，则运行此作业
  - 执行完一次后不再执行
  - 使用at命令时，一定要保证atd进程启动，使用ps-ef检查
- 命令格式：
  - at  [选项] [时间]
  - Ctrl + D结束at命令的输入

- at命令选项

  | 选项         | 含义                                                     |
  | ------------ | -------------------------------------------------------- |
  | -m           | 当指定的任务被完成后，将给用户发送邮件，即使没有标准输出 |
  | -I           | atq的别名                                                |
  | -d           | atrm的别名                                               |
  | -v           | 显示任务将被执行的时间                                   |
  | -c           | 打印任务的内容到标准输出                                 |
  | -V           | 显示版本信息                                             |
  | -q<队列>     | 使用指定的队列                                           |
  | -f<文件>     | 从指定文件读入任务而不是从标准输出                       |
  | -t<时间参数> | 以时间参数的形式提交要运行的任务                         |

  

# 8.磁盘分区和挂载

- Linux无论有多少个分区.分给哪一个目录,整个文件系统也只有一个根目录.它的每一个分区都是用来组成整个文件系统的一部分.Linux使用一种”载入”的处理办法.将分区和目录联系起来.这时要载入一个分区,将使它的存储空间在一个目录下获得.

## fdisk分区

​     fdisk是一个基于MBR老牌的分区工具，支持几乎所有的Linux的发型版本。

- fdisk命令只有具有超级用户权限才能运行
- 使用fdisk -l可以列出所有安装的磁盘及其分区信息
- 使用fdisk /dev/sd[a-z]可以对目标磁盘进行分区操作
- 分区之后需要使用partprobe命令让内核更新分区信息，否则需要重启才能识别新的分区
- /proc/partitions文件也可以用来查看分区信息

![img](https://images0.cnblogs.com/blog2015/500720/201507/071820125493964.png)

fdisk /dev/sd[a-z]指令

a  toggle a bootable flag   

b  edit bsd disklabel

c  toggle the dos compatibility flag

**d  delete a partition       删除一个分区**

**l  list known partition types          列出所有分区类型**

**m  print this menu         列出帮助信息**

**n  add a new partition     添加一个分区**

o  create a new empty DOS partition table         

**p  print the partition table      列出分区表**

**q  quit without saving changes       不保存，退出**

s  create a new empty Sun disklabel      

**t  change a partition's system id          改变分区类型**

u  change display/entry units

v  verify the partition table

**w  write table to disk and exit       把分区表写入硬盘并退出**

x  extra functionality (experts only)



## 文件系统 （格式化磁盘）

​     创建分区之后，分区还不可以使用，操作系统必须通过文件系统才能管理文件和数据，磁盘或分区需要创建文件系统之后才能为操作系统使用，创建文件系统的过程被称之为格式化。

- 没有文件系统的设备被成为裸（raw）设备。
- 常见的文件系统有fat32、NTFS、ext2、ext3、ext4、HFS等
- 文件系统之间的区别：日志、支持的分区大小、支持的单个文件大小、性能等等
- windows下主流文件系统是NTFS，Linux下主流文件系统是ext3、ext4

 

Linux支持的文件系统

​     **ext2     ext3     ext4     fat（msdos）     vfat**     

​     **nfs       iso9660  proc     gfs       jfs    ......**

 

**创建文件系统：**

​     mke2fs [参数] -t [文件系统类型] 分区

​     **参数：**

​          **-b   blocksize      指定文件系统块大小**

​          **-c                 建立文件系统时检查损坏块**

​          **-L   lable              指定卷标**

​          **-j                  建立文件系统日志（ext3、ext4默认建立日志）**

​     mkfs也可以用于创建文件系统,支持参数较少，不能进行精细化

​          mkfs.ext3     /dev/sdb1

​          mkfs.ext4 /dev/sdb2

​          mkfs.ext4 /dev/sdb1

![img](https://images0.cnblogs.com/blog2015/500720/201507/071820476745666.png)

**查看分区的文件系统的信息**

```
dumpe2fs /dev/sdb5
```

会列出sdb5分区下文件系统的详细信息

**文件系统标签**

给分区打上标签方便后期管理

```
e2label 分区   --- 显示分区标签，如果没有设置过，则显示为空

e2label 分区 标签名  ---  给分区设置标签
```

**检查并修复文件系统**

```
fsck /dev/sda*
```

 

![img](https://images0.cnblogs.com/blog2015/500720/201507/071821040804854.png)

 

**fsck -y /dev/sda\*   可以遇到错误不提示，直接修复**

对于损坏的又修复成功但无法确定位置的文件，fsck会把这些数据放入lost+found目录中

每次启动系统时候会对磁盘进行fsck操作

 



## 挂载硬盘

​     新硬盘分区完并且建立好文件系统之后，还需要挂载到一个目录上才可以使用

​     Linux需要手动进行挂载操作或者配置/etc/fstab文件来自动挂载

**手动挂载**

​          使用命令

```
mount [参数] 挂载分区 挂载点
```

​        **常用参数：**

​               **-t   指定文件系统的类型**

​               **-o   指定挂载选项**

​     挂载选项如图

![img](https://images0.cnblogs.com/blog2015/500720/201507/081118131112107.png)

​     使用命令

```
umount 文件系统或者挂载点
```

​    来卸载挂载的文件系统

如果在卸载过程中出现**device is busy**报错，则表示这个文件系统正在被使用，无法卸载

​     使用命令：

```
fuser -m /挂载目录
```

   来查看使用文件系统的进程

​     使用命令

```
lsof 挂载目录
```

　　来查看正在被使用的文件

**配置文件自动挂载**

​     编辑/etc/fstab文件可以自动挂载文件系统到指定目录下格式如下

![img](https://images0.cnblogs.com/blog2015/500720/201507/081118439712514.png)