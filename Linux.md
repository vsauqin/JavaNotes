Linux

# 1.常见概念和功能

## 1.1网络连接的三种方式

1. 桥接模式：虚拟机可以与外部系统通讯，但是容易造成IP冲突
2. NAT模式：网络地址转换模式，虚拟机可以与外部系统通讯，不造成ip冲突
3. 主机模式：独立的系统



## 1.2虚拟机的克隆

- 方式一：直接拷贝一份虚拟机文件
- 使用VMware工具进行克隆

## 1.3虚拟机快照

## 1.4虚拟机的迁移和删除

# 2.Linux文件与目录结构

## 文件

Linux中一切皆文件

## 目录结构

根目录：/

# 3.VI和VIM编辑器

## 一般模式

**进入： vim 目录名**

常用语法：

| 语法       | 功能描述                   |
| ---------- | -------------------------- |
| yy         | 复制光标当前的一行         |
| y数字y     | 从当前光标连续复制n行      |
| p          | 移动到目的行进行粘贴       |
| u          | 撤销上一步                 |
| dd         | 删除光标当前行             |
| d数字d     | 连续删除光标后的n行        |
| x          | 剪切位于当前光标的一个字符 |
| X          | 剪切当前光标的前一个字符   |
| yw         | 复制一个词                 |
| dw         | 删除一个词                 |
| shift + ^  | 移动到行头                 |
| shift + $  | 移动到行尾                 |
| w          | 移动到下一个词的词头       |
| e          | 移动到当前词的词尾         |
| 1 + G      | 移动到页头                 |
| G          | 移动到页尾                 |
| 数字 N + G | 移动到目标行               |



## 编辑模式

**进入 ： i**

常用语法：

| 按键 | 功能                       |
| ---- | -------------------------- |
| i    | 到当前光标前进行插入       |
| a    | 到当前光标后进行插入       |
| o    | 到当前光标的下一行进行插入 |
| I    | 到当前光标所在行的最前     |
| A    | 到当前光标所在行的最后     |
| O    | 到当前光标行的上一行       |

**退出： esc**

## 指令模式

| 命令           | 功能                                     |
| -------------- | ---------------------------------------- |
| ：w            | 保存                                     |
| ：q            | 退出                                     |
| ：wq           | 保存并退出                               |
| ：q！          | 不保存强制退出                           |
| /要查找的词    | n跳转到下一个目标词，N跳转到上一个目标词 |
| ：set nu       | 显示行号                                 |
| ：set nonu     | 不显示行号                               |
| ：nuh          | 取消高亮显示                             |
| ：s/old/new    | 替换当前行匹配到的第一个old为new         |
| ：s/old/new/g  | 替换当前行匹配到的所有old为new           |
| ：%s/old/new   | 替换文档中每行匹配到的第一个old为new     |
| ：%s/old/new/g | 替换文档中匹配到的所有old为new           |





# 4.开机，重启和用户登录注销



## 关机重启命令

| shut -h now     | 立刻进行关机           |
| --------------- | ---------------------- |
| shut -h 1       | 一分钟后关机           |
| shutdown -r now | 现在重启计算机         |
| halt            | 关机作用和上面一样     |
| reboot          | 现在重新启动计算机     |
| sync            | 把内存的数据同步到磁盘 |

**注意：**无论是重启还是关机，即使指令已经默认指向sync，但是还是要手动执行

## 用户登录和注销

注销：logout

登录使用普通账户登录需要使用**su -root**指令切换为管理员身份

在图形运行级别下无效，在运行级别3下有效

# 5实用指令

## 指定运行级别:

运行级别说明：

1. 0：关机
2. 1：单用户【找回丢失密码】
3. 2:多用户状态没有网络了
4. 3:多用状态有网络服务
5. 4:系统未使用留给自己
6. 5：图形界面
7. 6：重启系统

**注意：**可以通过init来切换不同的运行级别

## 帮助指令

- man获得帮助信息，基本语法：man[命令或者配置文件]
- help指令
  - 基本语法：help + 命令（功能描述：获得shell内置命令的帮助信息）



## 文件目录指令

- pwd指令
  - 基本语法pwd		功能描述：显示当前工作目录的绝对路径
- ls指令
  - 基本语法：ls[选项][目录或是文件]
  - 常用选项：-a：显示当前目录所有的文件和目录，包括隐藏的；-i：以列表的形式显示信息
- cd指令
  - 基本语法：cd[参数]		功能描述：切换到指定目录
  - cd~：回到自己的家目录
  - cd..：会到当前目录的上一级目录
- mkdir指令
  - 基本语法：mkdir [选项] 要创建的目录
  - -p：创建多级目录
- rmdir指令：删除空目录
  - 基本语法：rmdir [选项] 要删除的空目录
  - 如果需要删除非空目录，需要使用：rm -rf  要删除的目录
- touch指令：创建空文件夹
  - 基本语法：touch  文件名称 
- cp指令：拷贝文件到指定目录
  - 基本语法：cp  [选项] source  dest
  - 常用选项：-r：递归复制整个文件夹 
- rm指令：移除文件或目录
  - 基本语法：rm [选项] 要删除的文件或者目录
  - 常用选项：-r：递归删除整个文件夹；-f:强制删除不提示
- mv指令：移动文件或重命名
  - mv  oldNameFile  newNameFile ：重命名
  - mv /temp/movefile  /tergetFolder：移动文件
- cat指令：查看文件
  - 基本语法：cat  [选项]  要查看的文件
  - 常用选项：-n:显示行号
- less指令：用来分屏查看文件内容，功能与more类似
  - 基本语法:less 要查看的文件
- echo指令：输出内容到控制台
  - 基本语法：echo  [选项]   [输出内容]
- head指令:用于显示文件的开头部分，默认显示i文件的前十行
  - 基本语法：head  文件  （查看文件的前十行）
  - head  -n  5  文件：查看文件 尾五行，但是这五行容易改
- tail指令：用于输出文件尾部的内容，默认显示最后十行
  - 基本语法：tail  文件  （功能描述：查看文件尾十行内容）
  - tail  -n  5：查看看文件尾五行内容，5可以是任何数
  - tail  -f  文件：实时追踪文件所有的更新
- ln指令：符号链接，存放其他文件路径
  - 基本语法：ln  -s [元文件或目录]  [软链接名]
  - 例如：在/home目录下创建一个软链接/myroot,连接到/root目录：ln  -s  /root  /home/myroot
- history指令：查看执行过的指令
  - 查看最近十条： history 10
  - 执行编号为五的指令：！5

## 时间日期类

* date指令：显示当前日期
  * 基本语法
  * date：显示当前时间
  * date + %Y：显示当前年份
  * date + %m：显示当前月份
  * date + %d：显示当前是那一天
  * date + ”%Y - %m - %d   %H:%M:%S“：显示当前年月日时分秒
* date指令设置系统当前时间
  * 基本语法：date  -s  字符串时间
  * 例如：设置时间为2020-11-03  20：02 ：10；date  -s  ”2020-11-03  20：02：10“

## 搜索查找类

* cal指令：查看日历指令

  * 基本语法：cal[选项]（不加选项显示本月日历）

* find指令：在指定目录下进行递归搜索，将满足条件的文件显示在终端

  * 基本语法：find  [搜索范围]  [选项]

  * 选项说明：

    | 选项  | 功能                                        |
    | ----- | ------------------------------------------- |
    | -name | 按文件名查询                                |
    | -user | 查找指定用户名所有文件                      |
    | -size | 按照指定大小查找文件(+n大于，-n小于，n等于) |

* locate指令：快速定位文件路径

  * 基本语法：locate 搜索文件
  * 在使用该指令之前需要先使用updatedb指令创建一个数据库

* which指令：查看指令位于哪个目录下

* grep指令和管道符号 |

  * grep过滤查找；管道符号|表示将前一个命令的处理结果输出传递给后一个指令处理

  * 基本语法：grep[选项] 查找内容  原文件

  * 常用选项

    | 选项 | 功能             |
    | ---- | ---------------- |
    | -n   | 显示匹配行及行号 |
    | -i   | 忽略字母大小写   |



## 压缩和解压

- gzip/gunzip指令：前者用于压缩文件后者用于解压
  - 基本语法：gzip  文件(压缩文件只能将文件压缩为,gz文件)
  - gunzip  文件.gz（解压缩文件）

- zip/unzip指令：用于压缩和解压文件夹

  - zip常用选项：-r：递归压缩，及压缩目录
  - unzip常用选项：-d<目录>：解压到指定目录

- tar指令：打包指令，最后打包后的文件时.tar.gz文件

  - 基本语法：tar [选项]  XXX.tar.gz  打包的内容

  - 常用选项

    | 选项 |        功能        |
    | :--: | :----------------: |
    |  -c  |  产生.tar打包文件  |
    |  -v  |    显示详细信息    |
    |  -f  | 指定压缩后的文件名 |
    |  -z  |   打包同时压缩·    |
    |  -x  |   捷报.tar文件`    |



# 6.组管理和权限管理

## 组管理

### 所有者

- 一般为谁是文件的创建者，谁就是该文件的所有者
- 查看文件的所有者
  - 指令：ls  -shl
- 修改文件所有者
  - 指令：chown  用户名  文件名

### 所在组

- 创建组指令：groupadd  组名

- 应用实例
  - 创建一个组：groupadd monster
  - 创建一个用户，并放到monster中：useradd -g monster fox
- 查看文件目录所在组：ls -ahl
- 修改文件目录所在组：chgrp  组名  文件名



### 其他组

除了文件的所有者和所在组的用户外，系统的其他用户都是文件的其他组

- 改变用户所在组
  - usermod  -g  新组名  用户名
  - usermod  -d  目录名  用户名  改变该用户登录的初始目录



## 修改所有者和所在组

### 修改所有者

- chown  newowner  文件/目录                                改变所有者
- chown  newowner：newgroup                              文件/目录  改变所有者和所在组
- -r：如果是目录则使子文件或目录全部递归生效

### 修改所在组

- chgrp  newgroup  文件/目录                          改变所在组

## 权限管理

### 权限说明

使用ls -l指令后会显示以下内容：

-rwxrw-r--  1  root  root  1213  February 2  09：39  abc

- 0~9位说明
  - 第零位确定文件类型
  - i：链接
  - d：目录
  - c：字符设备文件
  - b：块设备，如硬盘
- 1~3位是所有者用户权限
  - r:代表可读
  - w：代表可写
  - x：代表可执行
- 4~6是所在组其他用户的权限
- 7~10是其他组用户的权限
- 第一个root是所属用户名
- 第二个root是所属用户所在组
- 1213代表文件字节数
- 后面是日期和时间
- 最后是用户名







### 修改权限

- chmod指令：修改文件或者目录的权限
- 第一种方式：+，-，=变更权限
  - u：所有者；g:所在组；o:其他人；a：所有人
  - 例子：给abx文件的所有者读写执行的权限，给所在组读写权限，给其他组读执行权限——>chomd  u= rwx，g = rx，o= rx abc
- 第二种：使用数字变更权限
  - r= 4；w= 2；x= 1；
  - chmod  u = rwx，g = rx，o=x 文件目录名   相当于   chmod  751  文件目录名









# 7.定时任务调度

## crond定时任务

概述：是指形同在某个时间执行的特定的命令或程序

**分类：**

1. 系统工作：有些重要的工作必须周而复始的工作
2. 个别用户工作：个别用户可能希望执行某些程序，如数据库的备份

**基本语法：**crontab[选项]

**常用选项：**

|  -e  |      编辑crontab定时任务      |
| :--: | :---------------------------: |
|  -l  |        查询crontab任务        |
|  -r  | 删除当前用户所有的crontab任务 |

  

- 特殊符号说明

  | 特殊符号 | 含义                                                         |
  | -------- | ------------------------------------------------------------ |
  | *        | 代表任何时间。比如第一个”*“就代表一小时中每分钟都执行一次    |
  | ，       | 代表不连续的时间。比如”0   8，12，16*  *  *“，就代表在每天的8点0分，12点0分，16点0分都执行一次命令 |
  | -        | 代表连续的时间范围。比如”0  5  *  *  *  1-6“，代表周一到周六的凌晨一点到五点执行命令 |
  | */n      | 代表每隔多久执行一次。比如”*/10  *  *  *  *  “，代表每隔十分钟执行一次命令 |

   

- crontab相关指令

  - crontab  -l：列出当前有哪些任务调度
  - crontab  -r:终止任务调度
  - service crond  restare ：重启任务调度

## at定时任务

- 基本介绍：
  - at命令是一次性定时计划任务，at的守护进程atd会以后台模式运行，检查作业列队来运行
  - 默认情况下，atd守护进程每六十秒检查作业列队，有作业是会检查作业的运行时间，如果时间与当前事件匹配，则运行此作业
  - 执行完一次后不再执行
  - 使用at命令时，一定要保证atd进程启动，使用ps-ef检查
- 命令格式：
  - at  [选项] [时间]
  - Ctrl + D结束at命令的输入

- at命令选项

  | 选项         | 含义                                                     |
  | ------------ | -------------------------------------------------------- |
  | -m           | 当指定的任务被完成后，将给用户发送邮件，即使没有标准输出 |
  | -I           | atq的别名                                                |
  | -d           | atrm的别名                                               |
  | -v           | 显示任务将被执行的时间                                   |
  | -c           | 打印任务的内容到标准输出                                 |
  | -V           | 显示版本信息                                             |
  | -q<队列>     | 使用指定的队列                                           |
  | -f<文件>     | 从指定文件读入任务而不是从标准输出                       |
  | -t<时间参数> | 以时间参数的形式提交要运行的任务                         |

  

# 8.磁盘分区和挂载

## 分区

- 查看设备挂载情况
  - 命令lsblk或者lsblk  -f
- 虚拟机增加硬盘步骤
  - 分区命令：fdisk  /dev/sdb
  - 开始对/sdb分区
  - m:显示命令列表
  - p：显示磁盘分区
  - n：新增分区
  - w：写入并退出
- 挂载命令： mount
- 取消挂载：umount
- 永久挂载：
  - 修改/etc/fstab实现
  - 添加完成后执行mount  -a立即生效



## 磁盘情况查询

- 查询整体使用情况
  - 基本语法：df  -h
- 查询指定目录的磁盘占用情况
  - 基本语法：du  -h
  - 查询时默认为当前目录
  -   -s：指定目录占用大小总汇
  - -h：带计量单位
  - -a：含文件
  - --max-depth=1：子目录深度
  - -c：列出明细的同时，增加汇总值





# 9.网络配置

# 10.进程

## 查询进程情况

- ps：显示系统执行的进程
  - -a：显示当前终端的所有进程信息
  - -u：以用户的格式显示进程信息
  - -x：显示后台进程运行的参数
  - 所显示字段的意义：
  - PID：进程识别号
  - TTY：终端机号
  - TIME：此进程所消CPU时间
  - CMD：正在执行的命令或者进程
  - USER：用户名称
  - %CPU：进程占用CPU的百分比
  - %MEM：进程占用物理内存的百分比
  - VSZ：进程占用虚拟内存的大小（单位：kb）
  - RSS：进程占用的物理内存的大小（单位：kb）

## 终止进程

- 基本语法：
  - kill  [选项]  进程号（通过进程号杀死进程）
  - killall  进程名称  （功能描述：通过进程名杀死进程，也支持通配符，在系统因为负载过大而变得很慢时很有用）
- 常用选项：
  - -9：表示强迫进程立即停止

## 查看进程数

- 基本语法：pstree  [选项] （可以更加直观的来看进程信息）
- 常用选项：
  - -p:显示进程的PID
  - -u：显示进程的所属用户

## 服务管理

- 服务的本质就是进程，但是是运行在后台，通常都会监听某个端口，等待其他程序的请求，比如（mysql，sshd，防火墙等），因此我们又称为守护进程
- service管理命令：
  - service  服务名  [start|stop|restart|reload|status]
  - service指令管理的服务在 /etc/init.d查看

- Linux的其中运行级别
  - 0：系统停机状态，系统默认不能设为0，否则不能正常启动
  - 1：单用户工作状态，root权限，用于系统维护，进制远程登录
  - 2：多用户状态（没有NFS），不支持网络
  - 3：完全的多用户状态（有NFS），无界面，登陆后进入控制台命令行模式
  - 4：系统未使用，保留
  - 5：X11控制台，登陆后进入图形GUI模式
  - 6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动

- 设置成5级别：systemd  set-default  graphical.target
- 设置成3级别：systemd  set-default  multi-user.target



___

- chkconfig指令
  - 介绍
    - chkconfig命令可以给服务的各个运行级别设置自启动或是关闭
    - chkconfig指令管理的服务在/etc/init.d查看
  - chkconfig基本语法
    - 查看服务：chkconfig  --list  [| grep  xxx]
    - chkconfig  服务名  --list
    - chkconfig  --level  5  服务名  on/off
- systemctl指令
  - 基本语法：systemctl  [start|stop|restart|staus]  服务名
  - systenctl指令在/user/lib/systemd/system查看
  - systemctl设置服务的自启动状态
    - systemctl list-unit-files [|grep  服务名] （查看服务开机启动状态）
    - systemctl  enable  服务名  （设置服务开机启动）
    - systemctl  disable  服务名  （关闭服务开机启动）
    - systemctl  is-enable  服务名  （查询某个服务是否自启动）
- firewall指令
  - 查看端口协议：netstat -anp |more
  - 打开端口：firewall-cmd  --permanent --add-port=端口号/协议
  - 关闭端口：firewall-cmd  --permanent --remove-port=端口号/协议
  - 重新载入才能生效：firewall-cmd --reload
  - 查询端口是否开放：firewall-cmd --query-port=端口/协议

## 动态监控进程

- top和ps命令相似，他们都用来显示正在执行的进程。最大的不同是，top在指定一段时间可以更新正在运行的进程
- 基本语法：top  [选项]
- 选项说明
  - -d 秒数：指定功能每隔几秒更新。默认是三秒
  - -i:使top不显示任何闲置或是僵死的进程
  - -p：通过指定监控进程id来仅仅监控某个进程的状态

- 交互操作说明：
  - P:以cpu使用率排序，默认就是此项
  - M:以内存的使用率来排序
  - N:以PID排序
  - q：退出top



# 11.rpm包管理

- rpm包的简单查询指令：rpm  -qa |grep  xx
- 其他查询指令
  - rpm -qa：查询所安装的所有rpm软件包
  - rpm -q  软件包名：查询软件包是否安装
  - rpm -qi  软件包名：查询软件包信息
  - rpm  -ql  软件包名：查询软件包中的文件
  - rpm  -qf  文件全路径名：查询文件所属的软件包

- 写在rpm包：rpm  -e  包名
  - 强制删除：添加--nodeps参数
- 安装rpm包：rpm  -ivh  包的全路径
  - 参数说明
  - i：install  安装
  - v：verbose  提示
  - h：hash  进度条

## yum

# 12.shell编程

## shell的变量\

### 普通变量

- Shell变量的介绍
  - 分为系统变量和用户自定义变量
  - 系统变量：$HOME,$PWD,$SHELL,$USER等等；
  - 显示当前shell中的所有变量：set
- shell变量的定义
  - 基本语法
    - 定义变量：变量名=值
    - 撤销变量：unset 变量
    - 声明静态变量：readonly变量，注意：不能unset
- 变量定义规则
  - 变量名称可以由字母，数字和下划线组成，但是不能以数字开头
  - 等号两侧不能有空格
  - 变量名称一般为大写
- 将命令的返回值赋给变量
  - A=‘data’反引号，运行里面的命令，并把结果返回给变量A
  - A=$(date)等价于反引号

### 环境变量

- 基本语法
  - export  变量名=变量值（功能描述： 将shell变量输出为环境变量/全局变量）
  - source  配置文件（功能描述：让修改后的配置信息立即生效）
  - echo $变量名（功能描述：查询化境变量的值）



### 位置参数变量

- 介绍：当执行一个shell脚本时，如果希望获取到的命令行的参数信息，就可以使用到位置参数变量
- 基本语法：
  - $n:（功能描述：n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，十以上的参数需要用大括号包含，如${10}）
  - $*:（功能描述：这个变量代表命令行中所有的参数， $ * 把所有的参数看成一个整体）
  - $@:(功能描述：这个变量也代表命令行中的所有参数，不过$@把每个参数区分对待)
  - $#:(功能描述：这个变量代表命令行中的所有参数的个数)

### 预定义变量

- 基本介绍：就是shell设计者实现已经定义好的变量，可以直接在shell脚本中使用
- 基本语法：
  - $$（功能描述：当前进程的进程号：PID）
  - $!:(功能描述：后台运行的最后一个进程的进程号)
  - $?:(功能描述：最后一次执行命令的返回状态。如果这个变量为0，证明上一个命令正确执行；如果是非零，则证明上一个命令执行不正确)

## 运算符

- 基本语法：

  - “$((运算式))”或"$[运算式]"或者expr m + n
  - 注意expr运算符间要有空格
  - expr m - n
  - \ *：乘，/：除；%：取余

  

## 条件判断

基本语法：[condition] (注意condition前后要加空格)

非空返回true，空值返回false

- 判断语句
  - =：字符串比较
  - 两个整数比较：
    - -lt：小于
    - -le：小于等于
    - -eq：等于
    - -gt：大于
    - -ge：大于等于
    - -ne：不等于
  - 按照文件权限进行判断
    - -r：有读的权限
    - -w：有写的权限
    - -x：有执行的权限
  - 按照文件类型进行判断
    - -f：文件存在并是一个常规的文件
    - -e：文件存在
    - -d：文件存在并是一个目录

## 流程控制

### case语句

- 基本语法

  ```java
  case $变量名 in "值一"）
  如果变量名等于值一，执行程序一
  ;;
  "值二"）
  如果变量名等于值二，执行程序二
  ;;
  省略其他分支...
  *)
  如果变量的值都不是以上值，则执行此程序
  ;;
  esac
  ```



### for循环

- 基本语法1：

  ```java
  for 变量  in 值1  值2  值3...
  do
  程序/代码
  done
  ```

- 基本语法2：

  ```java
  for((初始值;循环控制条件;变量变化))
  do
  程序
  done
  ```

- 
